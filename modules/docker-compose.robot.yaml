services:
  robot: 
    build: &robot_build
      context: ..
      dockerfile: docker/robot/robot.Dockerfile
      cache_from:
        - "${ROBOT_IMAGE:?}:${TAG}"
        - "${ROBOT_IMAGE:?}:main"
      args:
        BASE_IMAGE: ${BASE_IMAGE_OVERRIDE-}
    image: "${ROBOT_IMAGE:?}:${TAG}"
    profiles:
      - deploy
    command: /bin/bash -c "ros2 launch bringup_robot robot.launch.py"
    environment:
      - DISPLAY=${DISPLAY}  # Pass host display
      - TURTLEBOT3_MODEL=waffle
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix  # Mount X11 socket
      - ~/.Xauthority:/root/.Xauthority  # Mount Xauthority file
  
  robot_dev:
    build: *robot_build
    image: "${ROBOT_IMAGE:?}:dev_${TAG}"
    command: tail -F anything
    profiles:
      - develop
    volumes:
      - ${MONO_DIR}/src/robot:/root/ament_ws/src
